import{T as fs,a as pt,b as Sn,L as hs,c as ke,F as Rn,C as _,d as ee,S as Je,P as Ne,D as ps,M as Te,e as Ge,f as re,V as yt,g as ze,h as w,I as ms,i as gs,O as En,j as He,k as As,B as ie,l as xs,m as bn,n as vn,R as mt,o as St,p as lt,q as Ts,r as pe,s as We,t as ws,u as Be,v as Ms,w as v,x as ys,y as Ss,z as Rs,A as Ze,G as H,E as _n,H as Es,J as bs,K as vs,N as _s,Q as Ls,U as Ln,W as en,X as K,Y as Is,Z as Ns,_ as Ps,$ as Cs,a0 as Os,a1 as Us,a2 as Ds,a3 as Fs,a4 as ks,a5 as tn,a6 as nn,a7 as sn,a8 as on,a9 as Gs,aa as zs,ab as Hs,ac as Qe,ad as oe,ae as Le,af as j,ag as le,ah as Bs,ai as js,aj as Ks,ak as Vs,al as Ws,am as Xs,an as qs,ao as Ys,ap as Qs,aq as Js}from"./three-cc1e8477.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();function rn(u,e){if(e===fs)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),u;if(e===pt||e===Sn){let t=u.getIndex();if(t===null){const o=[],a=u.getAttribute("position");if(a!==void 0){for(let r=0;r<a.count;r++)o.push(r);u.setIndex(o),t=u.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),u}const i=t.count-2,n=[];if(e===pt)for(let o=1;o<=i;o++)n.push(t.getX(0)),n.push(t.getX(o)),n.push(t.getX(o+1));else for(let o=0;o<i;o++)o%2===0?(n.push(t.getX(o)),n.push(t.getX(o+1)),n.push(t.getX(o+2))):(n.push(t.getX(o+2)),n.push(t.getX(o+1)),n.push(t.getX(o)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=u.clone();return s.setIndex(n),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),u}class Zs extends hs{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new so(t)}),this.register(function(t){return new ho(t)}),this.register(function(t){return new po(t)}),this.register(function(t){return new mo(t)}),this.register(function(t){return new io(t)}),this.register(function(t){return new ro(t)}),this.register(function(t){return new ao(t)}),this.register(function(t){return new co(t)}),this.register(function(t){return new no(t)}),this.register(function(t){return new lo(t)}),this.register(function(t){return new oo(t)}),this.register(function(t){return new fo(t)}),this.register(function(t){return new uo(t)}),this.register(function(t){return new eo(t)}),this.register(function(t){return new go(t)}),this.register(function(t){return new Ao(t)})}load(e,t,i,n){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const c=ke.extractUrlBase(e);o=ke.resolveURL(c,this.path)}else o=ke.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){n?n(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},r=new Rn(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(c){try{s.parse(c,o,function(d){t(d),s.manager.itemEnd(e)},a)}catch(d){a(d)}},i,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,n){let s;const o={},a={},r=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(r.decode(new Uint8Array(e,0,4))===In){try{o[E.KHR_BINARY_GLTF]=new xo(e)}catch(l){n&&n(l);return}s=JSON.parse(o[E.KHR_BINARY_GLTF].content)}else s=JSON.parse(r.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new No(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const l=this.pluginCallbacks[d](c);l.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[l.name]=l,o[l.name]=!0}if(s.extensionsUsed)for(let d=0;d<s.extensionsUsed.length;++d){const l=s.extensionsUsed[d],f=s.extensionsRequired||[];switch(l){case E.KHR_MATERIALS_UNLIT:o[l]=new to;break;case E.KHR_DRACO_MESH_COMPRESSION:o[l]=new To(s,this.dracoLoader);break;case E.KHR_TEXTURE_TRANSFORM:o[l]=new wo;break;case E.KHR_MESH_QUANTIZATION:o[l]=new Mo;break;default:f.indexOf(l)>=0&&a[l]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(i,n)}parseAsync(e,t){const i=this;return new Promise(function(n,s){i.parse(e,t,n,s)})}}function $s(){let u={};return{get:function(e){return u[e]},add:function(e,t){u[e]=t},remove:function(e){delete u[e]},removeAll:function(){u={}}}}const E={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class eo{constructor(e){this.parser=e,this.name=E.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,n=t.length;i<n;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let n=t.cache.get(i);if(n)return n;const s=t.json,r=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const d=new _(16777215);r.color!==void 0&&d.setRGB(r.color[0],r.color[1],r.color[2],ee);const l=r.range!==void 0?r.range:0;switch(r.type){case"directional":c=new ps(d),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new Ne(d),c.distance=l;break;case"spot":c=new Je(d),c.distance=l,r.spot=r.spot||{},r.spot.innerConeAngle=r.spot.innerConeAngle!==void 0?r.spot.innerConeAngle:0,r.spot.outerConeAngle=r.spot.outerConeAngle!==void 0?r.spot.outerConeAngle:Math.PI/4,c.angle=r.spot.outerConeAngle,c.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return c.position.set(0,0,0),c.decay=2,he(c,r),r.intensity!==void 0&&(c.intensity=r.intensity),c.name=t.createUniqueName(r.name||"light_"+e),n=Promise.resolve(c),t.cache.add(i,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(r){return i._getNodeRef(t.cache,a,r)})}}class to{constructor(){this.name=E.KHR_MATERIALS_UNLIT}getMaterialType(){return Te}extendParams(e,t,i){const n=[];e.color=new _(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;e.color.setRGB(o[0],o[1],o[2],ee),e.opacity=o[3]}s.baseColorTexture!==void 0&&n.push(i.assignTexture(e,"map",s.baseColorTexture,Ge))}return Promise.all(n)}}class no{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class so{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:re}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];if(o.clearcoatFactor!==void 0&&(t.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new yt(a,a)}return Promise.all(s)}}class oo{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:re}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];return o.iridescenceFactor!==void 0&&(t.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(t.iridescenceIOR=o.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class io{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:re}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new _(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],ee)}return o.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",o.sheenColorTexture,Ge)),o.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class ro{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:re}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];return o.transmissionFactor!==void 0&&(t.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class ao{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:re}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];t.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=new _().setRGB(a[0],a[1],a[2],ee),Promise.all(s)}}class co{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:re}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=n.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class lo{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:re}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];t.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=new _().setRGB(a[0],a[1],a[2],ee),o.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",o.specularColorTexture,Ge)),Promise.all(s)}}class uo{constructor(e){this.parser=e,this.name=E.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:re}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];return t.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(i.assignTexture(t,"bumpMap",o.bumpTexture)),Promise.all(s)}}class fo{constructor(e){this.parser=e,this.name=E.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:re}extendMaterialParams(e,t){const i=this.parser,n=i.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],o=n.extensions[this.name];return o.anisotropyStrength!==void 0&&(t.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(t.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(i.assignTexture(t,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class ho{constructor(e){this.parser=e,this.name=E.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,n=i.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],o=t.options.ktx2Loader;if(!o){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,o)}}class po{constructor(e){this.parser=e,this.name=E.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=n.images[o.source];let r=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class mo{constructor(e){this.parser=e,this.name=E.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,n=i.json,s=n.textures[e];if(!s.extensions||!s.extensions[t])return null;const o=s.extensions[t],a=n.images[o.source];let r=i.textureLoader;if(a.uri){const c=i.options.manager.getHandler(a.uri);c!==null&&(r=c)}return this.detectSupport().then(function(c){if(c)return i.loadTextureImage(e,o.source,r);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class go{constructor(e){this.name=E.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const n=i.extensions[this.name],s=this.parser.getDependency("buffer",n.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const r=n.byteOffset||0,c=n.byteLength||0,d=n.count,l=n.byteStride,f=new Uint8Array(a,r,c);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(d,l,f,n.mode,n.filter).then(function(h){return h.buffer}):o.ready.then(function(){const h=new ArrayBuffer(d*l);return o.decodeGltfBuffer(new Uint8Array(h),d,l,f,n.mode,n.filter),h})})}else return null}}class Ao{constructor(e){this.name=E.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const n=t.meshes[i.mesh];for(const c of n.primitives)if(c.mode!==V.TRIANGLES&&c.mode!==V.TRIANGLE_STRIP&&c.mode!==V.TRIANGLE_FAN&&c.mode!==void 0)return null;const o=i.extensions[this.name].attributes,a=[],r={};for(const c in o)a.push(this.parser.getDependency("accessor",o[c]).then(d=>(r[c]=d,r[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const d=c.pop(),l=d.isGroup?d.children:[d],f=c[0].count,h=[];for(const m of l){const y=new ze,A=new w,x=new K,M=new w(1,1,1),O=new ms(m.geometry,m.material,f);for(let p=0;p<f;p++)r.TRANSLATION&&A.fromBufferAttribute(r.TRANSLATION,p),r.ROTATION&&x.fromBufferAttribute(r.ROTATION,p),r.SCALE&&M.fromBufferAttribute(r.SCALE,p),O.setMatrixAt(p,y.compose(A,x,M));for(const p in r)if(p==="_COLOR_0"){const R=r[p];O.instanceColor=new gs(R.array,R.itemSize,R.normalized)}else p!=="TRANSLATION"&&p!=="ROTATION"&&p!=="SCALE"&&m.geometry.setAttribute(p,r[p]);En.prototype.copy.call(O,m),this.parser.assignFinalMaterial(O),h.push(O)}return d.isGroup?(d.clear(),d.add(...h),d):h[0]}))}}const In="glTF",De=12,an={JSON:1313821514,BIN:5130562};class xo{constructor(e){this.name=E.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,De),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==In)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-De,s=new DataView(e,De);let o=0;for(;o<n;){const a=s.getUint32(o,!0);o+=4;const r=s.getUint32(o,!0);if(o+=4,r===an.JSON){const c=new Uint8Array(e,De+o,a);this.content=i.decode(c)}else if(r===an.BIN){const c=De+o;this.body=e.slice(c,c+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class To{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=E.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,n=this.dracoLoader,s=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},r={},c={};for(const d in o){const l=gt[d]||d.toLowerCase();a[l]=o[d]}for(const d in e.attributes){const l=gt[d]||d.toLowerCase();if(o[d]!==void 0){const f=i.accessors[e.attributes[d]],h=Ie[f.componentType];c[l]=h.name,r[l]=f.normalized===!0}}return t.getDependency("bufferView",s).then(function(d){return new Promise(function(l,f){n.decodeDracoFile(d,function(h){for(const m in h.attributes){const y=h.attributes[m],A=r[m];A!==void 0&&(y.normalized=A)}l(h)},a,c,ee,f)})})}}class wo{constructor(){this.name=E.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Mo{constructor(){this.name=E.KHR_MESH_QUANTIZATION}}class Nn extends Hs{constructor(e,t,i,n){super(e,t,i,n)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n*3+n;for(let o=0;o!==n;o++)t[o]=i[s+o];return t}interpolate_(e,t,i,n){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,r=a*2,c=a*3,d=n-t,l=(i-t)/d,f=l*l,h=f*l,m=e*c,y=m-c,A=-2*h+3*f,x=h-f,M=1-A,O=x-f+l;for(let p=0;p!==a;p++){const R=o[y+p+a],I=o[y+p+r]*d,F=o[m+p+a],g=o[m+p]*d;s[p]=M*R+O*I+A*F+x*g}return s}}const yo=new K;class So extends Nn{interpolate_(e,t,i,n){const s=super.interpolate_(e,t,i,n);return yo.fromArray(s).normalize().toArray(s),s}}const V={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Ie={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},cn={9728:Is,9729:bn,9984:Ns,9985:Ps,9986:Cs,9987:vn},ln={33071:Os,33648:Us,10497:mt},ut={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},gt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ue={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Ro={CUBICSPLINE:void 0,LINEAR:Ln,STEP:Ds},dt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Eo(u){return u.DefaultMaterial===void 0&&(u.DefaultMaterial=new pe({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Fs})),u.DefaultMaterial}function xe(u,e,t){for(const i in t.extensions)u[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function he(u,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(u.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function bo(u,e,t){let i=!1,n=!1,s=!1;for(let c=0,d=e.length;c<d;c++){const l=e[c];if(l.POSITION!==void 0&&(i=!0),l.NORMAL!==void 0&&(n=!0),l.COLOR_0!==void 0&&(s=!0),i&&n&&s)break}if(!i&&!n&&!s)return Promise.resolve(u);const o=[],a=[],r=[];for(let c=0,d=e.length;c<d;c++){const l=e[c];if(i){const f=l.POSITION!==void 0?t.getDependency("accessor",l.POSITION):u.attributes.position;o.push(f)}if(n){const f=l.NORMAL!==void 0?t.getDependency("accessor",l.NORMAL):u.attributes.normal;a.push(f)}if(s){const f=l.COLOR_0!==void 0?t.getDependency("accessor",l.COLOR_0):u.attributes.color;r.push(f)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(r)]).then(function(c){const d=c[0],l=c[1],f=c[2];return i&&(u.morphAttributes.position=d),n&&(u.morphAttributes.normal=l),s&&(u.morphAttributes.color=f),u.morphTargetsRelative=!0,u})}function vo(u,e){if(u.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)u.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(u.morphTargetInfluences.length===t.length){u.morphTargetDictionary={};for(let i=0,n=t.length;i<n;i++)u.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function _o(u){let e;const t=u.extensions&&u.extensions[E.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+ft(t.attributes):e=u.indices+":"+ft(u.attributes)+":"+u.mode,u.targets!==void 0)for(let i=0,n=u.targets.length;i<n;i++)e+=":"+ft(u.targets[i]);return e}function ft(u){let e="";const t=Object.keys(u).sort();for(let i=0,n=t.length;i<n;i++)e+=t[i]+":"+u[t[i]]+";";return e}function At(u){switch(u){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Lo(u){return u.search(/\.jpe?g($|\?)/i)>0||u.search(/^data\:image\/jpeg/)===0?"image/jpeg":u.search(/\.webp($|\?)/i)>0||u.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Io=new ze;class No{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new $s,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,s=-1;typeof navigator<"u"&&(i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||i||n&&s<98?this.textureLoader=new He(this.options.manager):this.textureLoader=new As(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Rn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(o){const a={scene:o[0][n.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:n.asset,parser:i,userData:{}};return xe(s,a,n),he(a,n),Promise.all(i._invokeAll(function(r){return r.afterRoot&&r.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let n=0,s=t.length;n<s;n++){const o=t[n].joints;for(let a=0,r=o.length;a<r;a++)e[o[a]].isBone=!0}for(let n=0,s=e.length;n<s;n++){const o=e[n];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(i[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const n=i.clone(),s=(o,a)=>{const r=this.associations.get(o);r!=null&&this.associations.set(a,r);for(const[c,d]of o.children.entries())s(d,a.children[c])};return s(i,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const n=e(t[i]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let n=0;n<t.length;n++){const s=e(t[n]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let n=this.cache.get(i);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":n=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(i,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(s,o){return i.getDependency(e,o)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[E.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(s,o){i.load(ke.resolveURL(t.uri,n.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const n=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+n)})}loadAccessor(e){const t=this,i=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const o=ut[n.type],a=Ie[n.componentType],r=n.normalized===!0,c=new a(n.count*o);return Promise.resolve(new ie(c,o,r))}const s=[];return n.bufferView!==void 0?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),n.sparse!==void 0&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],r=ut[n.type],c=Ie[n.componentType],d=c.BYTES_PER_ELEMENT,l=d*r,f=n.byteOffset||0,h=n.bufferView!==void 0?i.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let y,A;if(h&&h!==l){const x=Math.floor(f/h),M="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+x+":"+n.count;let O=t.cache.get(M);O||(y=new c(a,x*h,n.count*h/d),O=new xs(y,h/d),t.cache.add(M,O)),A=new ks(O,r,f%h/d,m)}else a===null?y=new c(n.count*r):y=new c(a,f,n.count*r),A=new ie(y,r,m);if(n.sparse!==void 0){const x=ut.SCALAR,M=Ie[n.sparse.indices.componentType],O=n.sparse.indices.byteOffset||0,p=n.sparse.values.byteOffset||0,R=new M(o[1],O,n.sparse.count*x),I=new c(o[2],p,n.sparse.count*r);a!==null&&(A=new ie(A.array.slice(),A.itemSize,A.normalized));for(let F=0,g=R.length;F<g;F++){const P=R[F];if(A.setX(P,I[F*r]),r>=2&&A.setY(P,I[F*r+1]),r>=3&&A.setZ(P,I[F*r+2]),r>=4&&A.setW(P,I[F*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return A})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,o=t.images[s];let a=this.textureLoader;if(o.uri){const r=i.manager.getHandler(o.uri);r!==null&&(a=r)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,i){const n=this,s=this.json,o=s.textures[e],a=s.images[t],r=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[r])return this.textureCache[r];const c=this.loadImageSource(t,i).then(function(d){d.flipY=!1,d.name=o.name||a.name||"",d.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(d.name=a.uri);const f=(s.samplers||{})[o.sampler]||{};return d.magFilter=cn[f.magFilter]||bn,d.minFilter=cn[f.minFilter]||vn,d.wrapS=ln[f.wrapS]||mt,d.wrapT=ln[f.wrapT]||mt,n.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[r]=c,c}loadImageSource(e,t){const i=this,n=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(l=>l.clone());const o=n.images[e],a=self.URL||self.webkitURL;let r=o.uri||"",c=!1;if(o.bufferView!==void 0)r=i.getDependency("bufferView",o.bufferView).then(function(l){c=!0;const f=new Blob([l],{type:o.mimeType});return r=a.createObjectURL(f),r});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(r).then(function(l){return new Promise(function(f,h){let m=f;t.isImageBitmapLoader===!0&&(m=function(y){const A=new tn(y);A.needsUpdate=!0,f(A)}),t.load(ke.resolveURL(l,s.path),m,void 0,h)})}).then(function(l){return c===!0&&a.revokeObjectURL(r),l.userData.mimeType=o.mimeType||Lo(o.uri),l}).catch(function(l){throw console.error("THREE.GLTFLoader: Couldn't load texture",r),l});return this.sourceCache[e]=d,d}assignTexture(e,t,i,n){const s=this;return this.getDependency("texture",i.index).then(function(o){if(!o)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(o=o.clone(),o.channel=i.texCoord),s.extensions[E.KHR_TEXTURE_TRANSFORM]){const a=i.extensions!==void 0?i.extensions[E.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const r=s.associations.get(o);o=s.extensions[E.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,r)}}return n!==void 0&&(o.colorSpace=n),e[t]=o,o})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const n=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,o=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+i.uuid;let r=this.cache.get(a);r||(r=new St,lt.prototype.copy.call(r,i),r.color.copy(i.color),r.map=i.map,r.sizeAttenuation=!1,this.cache.add(a,r)),i=r}else if(e.isLine){const a="LineBasicMaterial:"+i.uuid;let r=this.cache.get(a);r||(r=new Ts,lt.prototype.copy.call(r,i),r.color.copy(i.color),r.map=i.map,this.cache.add(a,r)),i=r}if(n||s||o){let a="ClonedMaterial:"+i.uuid+":";n&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let r=this.cache.get(a);r||(r=i.clone(),s&&(r.vertexColors=!0),o&&(r.flatShading=!0),n&&(r.normalScale&&(r.normalScale.y*=-1),r.clearcoatNormalScale&&(r.clearcoatNormalScale.y*=-1)),this.cache.add(a,r),this.associations.set(r,this.associations.get(i))),i=r}e.material=i}getMaterialType(){return pe}loadMaterial(e){const t=this,i=this.json,n=this.extensions,s=i.materials[e];let o;const a={},r=s.extensions||{},c=[];if(r[E.KHR_MATERIALS_UNLIT]){const l=n[E.KHR_MATERIALS_UNLIT];o=l.getMaterialType(),c.push(l.extendParams(a,s,t))}else{const l=s.pbrMetallicRoughness||{};if(a.color=new _(1,1,1),a.opacity=1,Array.isArray(l.baseColorFactor)){const f=l.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],ee),a.opacity=f[3]}l.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",l.baseColorTexture,Ge)),a.metalness=l.metallicFactor!==void 0?l.metallicFactor:1,a.roughness=l.roughnessFactor!==void 0?l.roughnessFactor:1,l.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",l.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",l.metallicRoughnessTexture))),o=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=We);const d=s.alphaMode||dt.OPAQUE;if(d===dt.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===dt.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==Te&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new yt(1,1),s.normalTexture.scale!==void 0)){const l=s.normalTexture.scale;a.normalScale.set(l,l)}if(s.occlusionTexture!==void 0&&o!==Te&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==Te){const l=s.emissiveFactor;a.emissive=new _().setRGB(l[0],l[1],l[2],ee)}return s.emissiveTexture!==void 0&&o!==Te&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,Ge)),Promise.all(c).then(function(){const l=new o(a);return s.name&&(l.name=s.name),he(l,s),t.associations.set(l,{materials:e}),s.extensions&&xe(n,l,s),l})}createUniqueName(e){const t=ws.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,n=this.primitiveCache;function s(a){return i[E.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(r){return un(r,a,t)})}const o=[];for(let a=0,r=e.length;a<r;a++){const c=e[a],d=_o(c),l=n[d];if(l)o.push(l.promise);else{let f;c.extensions&&c.extensions[E.KHR_DRACO_MESH_COMPRESSION]?f=s(c):f=un(new Be,c,t),n[d]={primitive:c,promise:f},o.push(f)}}return Promise.all(o)}loadMesh(e){const t=this,i=this.json,n=this.extensions,s=i.meshes[e],o=s.primitives,a=[];for(let r=0,c=o.length;r<c;r++){const d=o[r].material===void 0?Eo(this.cache):this.getDependency("material",o[r].material);a.push(d)}return a.push(t.loadGeometries(o)),Promise.all(a).then(function(r){const c=r.slice(0,r.length-1),d=r[r.length-1],l=[];for(let h=0,m=d.length;h<m;h++){const y=d[h],A=o[h];let x;const M=c[h];if(A.mode===V.TRIANGLES||A.mode===V.TRIANGLE_STRIP||A.mode===V.TRIANGLE_FAN||A.mode===void 0)x=s.isSkinnedMesh===!0?new Ms(y,M):new v(y,M),x.isSkinnedMesh===!0&&x.normalizeSkinWeights(),A.mode===V.TRIANGLE_STRIP?x.geometry=rn(x.geometry,Sn):A.mode===V.TRIANGLE_FAN&&(x.geometry=rn(x.geometry,pt));else if(A.mode===V.LINES)x=new ys(y,M);else if(A.mode===V.LINE_STRIP)x=new Ss(y,M);else if(A.mode===V.LINE_LOOP)x=new Rs(y,M);else if(A.mode===V.POINTS)x=new Ze(y,M);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(x.geometry.morphAttributes).length>0&&vo(x,s),x.name=t.createUniqueName(s.name||"mesh_"+e),he(x,s),A.extensions&&xe(n,x,A),t.assignFinalMaterial(x),l.push(x)}for(let h=0,m=l.length;h<m;h++)t.associations.set(l[h],{meshes:e,primitives:h});if(l.length===1)return s.extensions&&xe(n,l[0],s),l[0];const f=new H;s.extensions&&xe(n,f,s),t.associations.set(f,{meshes:e});for(let h=0,m=l.length;h<m;h++)f.add(l[h]);return f})}loadCamera(e){let t;const i=this.json.cameras[e],n=i[i.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new _n(Es.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):i.type==="orthographic"&&(t=new bs(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),he(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let n=0,s=t.joints.length;n<s;n++)i.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(n){const s=n.pop(),o=n,a=[],r=[];for(let c=0,d=o.length;c<d;c++){const l=o[c];if(l){a.push(l);const f=new ze;s!==null&&f.fromArray(s.array,c*16),r.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new vs(a,r)})}loadAnimation(e){const t=this.json,i=this,n=t.animations[e],s=n.name?n.name:"animation_"+e,o=[],a=[],r=[],c=[],d=[];for(let l=0,f=n.channels.length;l<f;l++){const h=n.channels[l],m=n.samplers[h.sampler],y=h.target,A=y.node,x=n.parameters!==void 0?n.parameters[m.input]:m.input,M=n.parameters!==void 0?n.parameters[m.output]:m.output;y.node!==void 0&&(o.push(this.getDependency("node",A)),a.push(this.getDependency("accessor",x)),r.push(this.getDependency("accessor",M)),c.push(m),d.push(y))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(r),Promise.all(c),Promise.all(d)]).then(function(l){const f=l[0],h=l[1],m=l[2],y=l[3],A=l[4],x=[];for(let M=0,O=f.length;M<O;M++){const p=f[M],R=h[M],I=m[M],F=y[M],g=A[M];if(p===void 0)continue;p.updateMatrix&&p.updateMatrix();const P=i._createAnimationTracks(p,R,I,F,g);if(P)for(let N=0;N<P.length;N++)x.push(P[N])}return new _s(s,void 0,x)})}createNodeMesh(e){const t=this.json,i=this,n=t.nodes[e];return n.mesh===void 0?null:i.getDependency("mesh",n.mesh).then(function(s){const o=i._getNodeRef(i.meshCache,n.mesh,s);return n.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let r=0,c=n.weights.length;r<c;r++)a.morphTargetInfluences[r]=n.weights[r]}),o})}loadNode(e){const t=this.json,i=this,n=t.nodes[e],s=i._loadNodeShallow(e),o=[],a=n.children||[];for(let c=0,d=a.length;c<d;c++)o.push(i.getDependency("node",a[c]));const r=n.skin===void 0?Promise.resolve(null):i.getDependency("skin",n.skin);return Promise.all([s,Promise.all(o),r]).then(function(c){const d=c[0],l=c[1],f=c[2];f!==null&&d.traverse(function(h){h.isSkinnedMesh&&h.bind(f,Io)});for(let h=0,m=l.length;h<m;h++)d.add(l[h]);return d})}_loadNodeShallow(e){const t=this.json,i=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],o=s.name?n.createUniqueName(s.name):"",a=[],r=n._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return r&&a.push(r),s.camera!==void 0&&a.push(n.getDependency("camera",s.camera).then(function(c){return n._getNodeRef(n.cameraCache,s.camera,c)})),n._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let d;if(s.isBone===!0?d=new Ls:c.length>1?d=new H:c.length===1?d=c[0]:d=new En,d!==c[0])for(let l=0,f=c.length;l<f;l++)d.add(c[l]);if(s.name&&(d.userData.name=s.name,d.name=o),he(d,s),s.extensions&&xe(i,d,s),s.matrix!==void 0){const l=new ze;l.fromArray(s.matrix),d.applyMatrix4(l)}else s.translation!==void 0&&d.position.fromArray(s.translation),s.rotation!==void 0&&d.quaternion.fromArray(s.rotation),s.scale!==void 0&&d.scale.fromArray(s.scale);return n.associations.has(d)||n.associations.set(d,{}),n.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],n=this,s=new H;i.name&&(s.name=n.createUniqueName(i.name)),he(s,i),i.extensions&&xe(t,s,i);const o=i.nodes||[],a=[];for(let r=0,c=o.length;r<c;r++)a.push(n.getDependency("node",o[r]));return Promise.all(a).then(function(r){for(let d=0,l=r.length;d<l;d++)s.add(r[d]);const c=d=>{const l=new Map;for(const[f,h]of n.associations)(f instanceof lt||f instanceof tn)&&l.set(f,h);return d.traverse(f=>{const h=n.associations.get(f);h!=null&&l.set(f,h)}),l};return n.associations=c(s),s})}_createAnimationTracks(e,t,i,n,s){const o=[],a=e.name?e.name:e.uuid,r=[];ue[s.path]===ue.weights?e.traverse(function(f){f.morphTargetInfluences&&r.push(f.name?f.name:f.uuid)}):r.push(a);let c;switch(ue[s.path]){case ue.weights:c=sn;break;case ue.rotation:c=on;break;case ue.position:case ue.scale:c=nn;break;default:switch(i.itemSize){case 1:c=sn;break;case 2:case 3:default:c=nn;break}break}const d=n.interpolation!==void 0?Ro[n.interpolation]:Ln,l=this._getArrayFromAccessor(i);for(let f=0,h=r.length;f<h;f++){const m=new c(r[f]+"."+ue[s.path],t.array,l,d);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=At(t.constructor),n=new Float32Array(t.length);for(let s=0,o=t.length;s<o;s++)n[s]=t[s]*i;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const n=this instanceof on?So:Nn;return new n(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Po(u,e,t){const i=e.attributes,n=new Gs;if(i.POSITION!==void 0){const a=t.json.accessors[i.POSITION],r=a.min,c=a.max;if(r!==void 0&&c!==void 0){if(n.set(new w(r[0],r[1],r[2]),new w(c[0],c[1],c[2])),a.normalized){const d=At(Ie[a.componentType]);n.min.multiplyScalar(d),n.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new w,r=new w;for(let c=0,d=s.length;c<d;c++){const l=s[c];if(l.POSITION!==void 0){const f=t.json.accessors[l.POSITION],h=f.min,m=f.max;if(h!==void 0&&m!==void 0){if(r.setX(Math.max(Math.abs(h[0]),Math.abs(m[0]))),r.setY(Math.max(Math.abs(h[1]),Math.abs(m[1]))),r.setZ(Math.max(Math.abs(h[2]),Math.abs(m[2]))),f.normalized){const y=At(Ie[f.componentType]);r.multiplyScalar(y)}a.max(r)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}u.boundingBox=n;const o=new zs;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,u.boundingSphere=o}function un(u,e,t){const i=e.attributes,n=[];function s(o,a){return t.getDependency("accessor",o).then(function(r){u.setAttribute(a,r)})}for(const o in i){const a=gt[o]||o.toLowerCase();a in u.attributes||n.push(s(i[o],a))}if(e.indices!==void 0&&!u.index){const o=t.getDependency("accessor",e.indices).then(function(a){u.setIndex(a)});n.push(o)}return en.workingColorSpace!==ee&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${en.workingColorSpace}" not supported.`),he(u,e),Po(u,e,t),Promise.all(n).then(function(){return e.targets!==void 0?bo(u,e.targets,t):u})}function Co(u={}){const e=Math.min(u.numStars||500,5e3);function t(){const c=Math.random()*3e3+3e3,d=Math.random(),l=Math.random(),f=2*Math.PI*d,h=Math.acos(2*l-1);let m=c*Math.sin(h)*Math.cos(f),y=c*Math.sin(h)*Math.sin(f),A=c*Math.cos(h),x;const M=Math.random();return M<.7?x=.6+Math.random()*.1:M<.85?x=Math.random()*.1:x=.3+Math.random()*.2,{pos:new w(m,y,A),hue:x,minDist:c}}const i=[],n=[];let s;for(let c=0;c<e;c+=1){let d=t();const{pos:l,hue:f}=d,h=.3+Math.random()*.5,m=.6+Math.random()*.4;s=new _().setHSL(f,h,m),i.push(l.x,l.y,l.z),n.push(s.r,s.g,s.b)}const o=new Be;o.setAttribute("position",new Qe(i,3)),o.setAttribute("color",new Qe(n,3));const a=new St({size:15,vertexColors:!0,map:new He().load("./textures/stars/circle.png"),transparent:!0,blending:oe,depthTest:!0,depthWrite:!0,opacity:1}),r=new Ze(o,a);return r.name="starfield",console.log("创建了星空对象，星星数量:",e),r}function $(u={}){const{rimHex:e=35071,facingHex:t=0}=u,i={color1:{value:new _(e)},color2:{value:new _(t)},fresnelBias:{value:.1},fresnelScale:{value:1},fresnelPower:{value:4}},n=`
  uniform float fresnelBias;
  uniform float fresnelScale;
  uniform float fresnelPower;
  
  varying float vReflectionFactor;
  
  void main() {
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
  
    vec3 worldNormal = normalize( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );
  
    vec3 I = worldPosition.xyz - cameraPosition;
  
    vReflectionFactor = fresnelBias + fresnelScale * pow( 1.0 + dot( normalize( I ), worldNormal ), fresnelPower );
  
    gl_Position = projectionMatrix * mvPosition;
  }
  `,s=`
  uniform vec3 color1;
  uniform vec3 color2;
  
  varying float vReflectionFactor;
  
  void main() {
    float f = clamp( vReflectionFactor, 0.0, 1.0 );
    gl_FragColor = vec4(mix(color2, color1, vec3(f)), f);
  }
  `;return new Le({uniforms:i,vertexShader:n,fragmentShader:s,transparent:!0,blending:oe})}function Oo(u={}){const e={count:200,color:65535,size:{min:.025,max:.05},lifetime:{min:.5,max:.6},speed:{min:.2,max:.6},spread:{x:.05,y:.05,z:.08},...u},t=new Be,i=new St({color:e.color,size:e.size.max,transparent:!0,blending:oe,sizeAttenuation:!0,depthWrite:!1,vertexColors:!0,opacity:1});try{const R=new He().load("./textures/stars/circle.png");i.map=R,i.alphaMap=R}catch(p){console.warn("无法加载粒子贴图:",p)}const n=new Ze(t,i);n.renderOrder=999,n.frustumCulled=!1;const s=new Float32Array(e.count*3),o=[],a=new Float32Array(e.count),r=new Float32Array(e.count*3),c=[],d=[],l=new Int8Array(e.count),f=[new w(0,0,0),new w(0,0,0)],h=[];for(let p=0;p<10;p++)h.push(new w);for(let p=0;p<e.count;p++){s[p*3]=0,s[p*3+1]=0,s[p*3+2]=0,r[p*3]=0,r[p*3+1]=1,r[p*3+2]=1,o.push({x:(Math.random()-.5)*e.spread.x,y:(Math.random()-.5)*e.spread.y,z:Math.random()*e.speed.max+e.speed.min}),a[p]=Math.random()*(e.size.max-e.size.min)+e.size.min;const R=Math.random()*(e.lifetime.max-e.lifetime.min)+e.lifetime.min;d.push(R),c.push(0),l[p]=p<e.count/2?0:1}t.setAttribute("position",new ie(s,3)),t.setAttribute("size",new ie(a,1)),t.setAttribute("color",new ie(r,3));let m=0;function y(p,R=1,I=!1,F=null,g=null,P=null){p=Math.min(p,.1);const N=t.attributes.position.array,te=I?Math.min(3,Math.ceil(R*1)):Math.min(1,Math.ceil(R*.5)),X=F!==null&&g!==null&&P!==null;let k=0;for(let T=0;T<e.count;T++){const ne=l[T],B=f[ne];if(c[T]>=d[T]){if(m<te){N[T*3]=B.x,N[T*3+1]=B.y,N[T*3+2]=B.z;const C=Math.max(.8,R),D=o[T];if(X){const z=(Math.random()-.5)*e.spread.x,q=(Math.random()-.5)*e.spread.y,se=Math.random()*e.speed.max*C+e.speed.min;D.x=F.x*se+g.x*z+P.x*q,D.y=F.y*se+g.y*z+P.y*q,D.z=F.z*se+g.z*z+P.z*q}else D.x=(Math.random()-.5)*e.spread.x,D.y=(Math.random()-.5)*e.spread.y,D.z=Math.random()*e.speed.max*C+e.speed.min;c[T]=0,d[T]=Math.random()*(e.lifetime.max-e.lifetime.min)+e.lifetime.min,r[T*3]=0,r[T*3+1]=1,r[T*3+2]=1,m++}}else{N[T*3]+=o[T].x*p,N[T*3+1]+=o[T].y*p,N[T*3+2]+=o[T].z*p,c[T]+=p;const C=c[T]/d[T];let D=1;C<.2?D=C*5:D=1-(C-.2)*1.25;const z=a[T]*Math.max(0,D);if(t.attributes.size.array[T]=z,C>.5){const q=(C-.5)*2;r[T*3]=0,r[T*3+1]=Math.max(0,1-q*.8),r[T*3+2]=Math.max(.2,1-q*.5)}k++}}m=0,k>0&&(t.attributes.position.needsUpdate=!0,t.attributes.size.needsUpdate=!0,t.attributes.color.needsUpdate=!0)}function A(p){n.position.copy(p)}function x(p,R){f[0].copy(p),f[1].copy(R)}function M(){for(let p=0;p<e.count;p++){c[p]=d[p]+1;const R=l[p],I=f[R];s[p*3]=I.x,s[p*3+1]=I.y,s[p*3+2]=I.z}t.attributes.position.needsUpdate=!0,m=0}function O(p,R,I){const F=Math.min(20,e.count);for(let g=0;g<F;g++){const P=l[g],N=f[P];if(p&&R&&I){const te=(Math.random()-.5)*.1,X=(Math.random()-.5)*.1,k=(Math.random()-.5)*.8-.1;s[g*3]=N.x,s[g*3+1]=N.y,s[g*3+2]=N.z,s[g*3]+=R.x*te+I.x*X+p.x*k,s[g*3+1]+=R.y*te+I.y*X+p.y*k,s[g*3+2]+=R.z*te+I.z*X+p.z*k;const T=(Math.random()-.5)*e.spread.x*1.5,ne=(Math.random()-.5)*e.spread.y*1.5,B=Math.random()*e.speed.max*2+e.speed.min;o[g].x=p.x*B+R.x*T+I.x*ne,o[g].y=p.y*B+R.y*T+I.y*ne,o[g].z=p.z*B+R.z*T+I.z*ne}else s[g*3]=N.x+(Math.random()-.5)*.1,s[g*3+1]=N.y+(Math.random()-.5)*.1,s[g*3+2]=N.z+(Math.random()-.5)*.8-.1,o[g].x=(Math.random()-.5)*e.spread.x*1.5,o[g].y=(Math.random()-.5)*e.spread.y*1.5,o[g].z=Math.random()*e.speed.max*2+e.speed.min;c[g]=Math.random()*d[g]*.7,r[g*3]=0,r[g*3+1]=1,r[g*3+2]=1}t.attributes.position.needsUpdate=!0,t.attributes.size.needsUpdate=!0,t.attributes.color.needsUpdate=!0}return{particles:n,update:y,setPosition:A,setEmitterPositions:x,clearAllParticles:M,init:O}}function Uo(u={}){const e=new He,t=new H,i=new j(100*1.5,15),n=new Le({uniforms:{time:{value:0},sunTexture:{value:e.load("./textures/sunmap.jpg")},sunColor:{value:new _(16755200)},flareColor:{value:new _(16720384)}},vertexShader:`
      varying vec2 vUv;
      varying vec3 vNormal;
      varying vec3 vPosition;
      
      void main() {
        vUv = uv;
        vNormal = normalize(normalMatrix * normal);
        vPosition = position;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform float time;
      uniform sampler2D sunTexture;
      uniform vec3 sunColor;
      uniform vec3 flareColor;
      
      varying vec2 vUv;
      varying vec3 vNormal;
      varying vec3 vPosition;
      
      // 噪声函数
      float noise(vec3 p) {
        vec3 i = floor(p);
        vec3 f = fract(p);
        f = f * f * (3.0 - 2.0 * f);
        
        float n = i.x + i.y * 157.0 + 113.0 * i.z;
        return mix(
          mix(
            mix(fract(sin(n + 0.0) * 43758.5453), fract(sin(n + 1.0) * 43758.5453), f.x),
            mix(fract(sin(n + 157.0) * 43758.5453), fract(sin(n + 158.0) * 43758.5453), f.x),
            f.y
          ),
          mix(
            mix(fract(sin(n + 113.0) * 43758.5453), fract(sin(n + 114.0) * 43758.5453), f.x),
            mix(fract(sin(n + 270.0) * 43758.5453), fract(sin(n + 271.0) * 43758.5453), f.x),
            f.y
          ),
          f.z
        );
      }
      
      void main() {
        // 基础纹理
        vec4 texColor = texture2D(sunTexture, vUv);
        
        // 创建动态噪声，用于太阳耀斑和表面扰动
        float noiseScale = 2.0;
        float noiseTime = time * 0.2;
        vec3 noisePos = vPosition * noiseScale + noiseTime;
        float n = noise(noisePos);
        float n2 = noise(noisePos * 2.0 + vec3(noiseTime));
        
        // 创建红色耀斑效果
        float flareIntensity = pow(n, 3.0) * pow(n2, 2.0) * 2.0;
        
        // 创建表面明亮效果
        float brightSpot = pow(max(0.0, dot(vNormal, vec3(0.0, 0.0, 1.0))), 0.6);
        
        // 合并颜色
        vec3 finalColor = texColor.rgb * sunColor;
        finalColor += flareColor * flareIntensity;
        finalColor *= (1.0 + brightSpot * 0.6);
        
        // 增强整体亮度
        finalColor = pow(finalColor, vec3(0.8)) * 1.5;
        
        gl_FragColor = vec4(finalColor, 1.0);
      }
    `,transparent:!1,depthWrite:!0}),s=new v(i,n);t.add(s);const o=new Le({uniforms:{color:{value:new _(16763938)}},vertexShader:`
      varying vec3 vNormal;
      void main() {
        vNormal = normalize(normalMatrix * normal);
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform vec3 color;
      varying vec3 vNormal;
      void main() {
        float intensity = pow(0.65 - dot(vNormal, vec3(0, 0, 1.0)), 2.0);
        gl_FragColor = vec4(color, 1.0) * intensity;
      }
    `,blending:oe,transparent:!0}),a=new j(95*1.5,15),r=new Te({map:e.load("./textures/sunmap.jpg"),blending:oe,transparent:!0,opacity:.6}),c=new v(a,r);c.scale.setScalar(.99),t.add(c);const d=new v(i,o);d.scale.setScalar(1.3),t.add(d);const l=new Ne(16777130,500,500);l.position.set(0,0,0),s.add(l);const f=new Ne(16777215,1e6,1e10);f.position.set(0,0,0),t.add(f);const h=100*1.5,m=400,y=.39,A=.72,x=1,M=1.52,O=5.2,p=9.54,R=19.2,I=30.06,F=39.5,g=10,P=.38,N=.95,te=.53,X=11.2,k=9.45,T=4,ne=3.88,B=.18,C=.27,D=new H;t.add(D);const z=new j(g*P,8),q=new le({map:e.load("./textures/mercury/mercurymapthumb.jpg"),bumpMap:e.load("./textures/mercury/mercurybumpthumb.jpg"),bumpScale:.04,transparent:!1}),se=new v(z,q);D.add(se);const $e=new v(z,$(new _(7829367)));$e.scale.setScalar(1.01),D.add($e),D.position.set(m*y,0,0);const ae=new H;t.add(ae);const Rt=new j(g*N,8),Gn=new le({map:e.load("./textures/venus/venusmapthumb.jpg"),bumpMap:e.load("./textures/venus/venusbumpthumb.jpg"),bumpScale:.04,transparent:!1}),Et=new v(Rt,Gn);ae.add(Et);const bt=new v(Rt,$(new _(12298871)));bt.scale.setScalar(1.02),ae.add(bt),ae.position.set(m*A,0,0);const Me=new H;t.add(Me);const ye=new H;ye.rotation.z=-23.4*Math.PI/180,Me.add(ye);const je=new j(g,12),zn=new le({map:e.load("./textures/00_earthmap1k.jpg"),specularMap:e.load("./textures/02_earthspec1k.jpg"),bumpMap:e.load("./textures/01_earthbump1k.jpg"),bumpScale:.04,transparent:!1}),vt=new v(je,zn);ye.add(vt);const Hn=new Te({map:e.load("./textures/03_earthlights1k.jpg"),blending:oe}),_t=new v(je,Hn);ye.add(_t);const Bn=new pe({map:e.load("./textures/04_earthcloudmap.jpg"),transparent:!0,opacity:.7,alphaMap:e.load("./textures/05_earthcloudmaptrans.jpg")}),et=new v(je,Bn);et.scale.setScalar(1.003),ye.add(et);const tt=new v(je,$(new _(6724095)));tt.scale.setScalar(1.01),ye.add(tt),Me.position.set(m*x,0,0);const Se=new H;Me.add(Se);const Lt=new j(g*C,8),jn=new le({map:e.load("./textures/moonmapthumb.jpg"),bumpMap:e.load("./textures/moonbumpthumb2.jpg"),bumpScale:.02,transparent:!1}),It=new v(Lt,jn);Se.add(It);const Nt=new v(Lt,$(new _(8947848)));Nt.scale.setScalar(1.01),Se.add(Nt),Se.position.set(g*2.5,0,0);const Re=new H;t.add(Re);const Pt=new j(g*te,8),Kn=new pe({map:e.load("./textures/mars/mars_thumbnail.jpg"),normalMap:e.load("./textures/mars/mars_normal_thumbnail.jpg"),normalScale:new yt(.8,.8),metalnessMap:e.load("./textures/mars/mars_topo_thumbnail.jpg"),metalness:.3,roughness:.7,transparent:!1}),Ct=new v(Pt,Kn);Re.add(Ct);const Ot=new v(Pt,$(new _(11162931)));Ot.scale.setScalar(1.01),Re.add(Ot),Re.position.set(m*M,0,0);const Ee=new H;t.add(Ee);const Ut=new j(g*X,10),Vn=new pe({map:e.load("./textures/jupiter/jupitermapthumb.jpg"),bumpScale:.02,emissive:new _(5583633),emissiveIntensity:.35,roughness:.7,metalness:.3,transparent:!1}),Dt=new v(Ut,Vn);Ee.add(Dt);const Ft=new v(Ut,$({rimHex:16764040,facingHex:3346688}));Ft.scale.setScalar(1.03),Ee.add(Ft),Ee.position.set(m*O,0,0);const me=new H;t.add(me);const kt=new j(g*k,10),Wn=new pe({map:e.load("./textures/saturn/saturnmapthumb.jpg"),bumpScale:.02,emissive:new _(5588002),emissiveIntensity:.35,roughness:.7,metalness:.3,transparent:!1}),Gt=new v(kt,Wn);me.add(Gt);const Xn=dn(g*k*1.2,g*k*2.2,160),qn=new pe({map:e.load("./textures/saturn/saturnringcolorthumb.jpg"),transparent:!0,alphaMap:e.load("./textures/saturn/saturnringpatternthumb.gif"),side:We,emissive:new _(14535850),emissiveIntensity:.6,opacity:.95}),nt=new v(Xn,qn);nt.rotation.x=Math.PI/2+Math.PI/6,me.add(nt);const zt=new v(kt,$(new _(14535833)));zt.scale.setScalar(1.01),me.add(zt),me.position.set(m*p,0,0);const ge=new H;t.add(ge);const Ht=new j(g*T,8),Yn=new le({map:e.load("./textures/uranus/uranusmapthumb.jpg"),bumpScale:.02,color:12648447,transparent:!1}),Bt=new v(Ht,Yn);ge.add(Bt);const Qn=dn(g*T*1.4,g*T*2.2,100),Jn=new le({map:e.load("./textures/uranus/uranusringcolour.jpg"),transparent:!0,alphaMap:e.load("./textures/uranus/uranusringtrans.jpg"),side:We,emissive:new _(11206655),emissiveIntensity:.4,opacity:.9}),st=new v(Qn,Jn);st.rotation.x=Math.PI/1.2,ge.add(st);const jt=new v(Ht,$(new _(65484)));jt.scale.setScalar(1.01),ge.add(jt),ge.position.set(m*R,0,0);const be=new H;t.add(be);const Kt=new j(g*ne,8),Zn=new le({map:e.load("./textures/neptune/neptunemapthumb.jpg"),bumpScale:.02,color:4474111,transparent:!1}),Vt=new v(Kt,Zn);be.add(Vt);const Wt=new v(Kt,$(new _(39423)));Wt.scale.setScalar(1.01),be.add(Wt),be.position.set(m*I,0,0);const ve=new H;t.add(ve);const Xt=new j(g*B,7),$n=new le({map:e.load("./textures/pluto/plutomapthumb.jpg"),bumpMap:e.load("./textures/pluto/plutobumpthumb.jpg"),bumpScale:.04,transparent:!1}),qt=new v(Xt,$n);ve.add(qt);const Yt=new v(Xt,$(new _(7829384)));Yt.scale.setScalar(1.01),ve.add(Yt),ve.position.set(m*F,0,0);const Qt=new Bs(140*1.5,15*1.5,20,100),ot=new Le({uniforms:{time:{value:0},color:{value:new _(16724736)}},vertexShader:`
      uniform float time;
      varying vec3 vPosition;
      
      void main() {
        // 添加基于时间的波动，增加波动幅度
        vec3 pos = position;
        float wave = sin(position.x * 5.0 + time * 2.0) * cos(position.y * 5.0 + time * 3.0) * 0.7;
        pos.x += wave * 4.0;
        pos.y += wave * 4.0;
        pos.z += wave * 4.0;
        
        vPosition = pos;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
      }
    `,fragmentShader:`
      uniform vec3 color;
      uniform float time;
      varying vec3 vPosition;
      
      void main() {
        vec3 pos = vPosition;
        
        // 创建动态闪烁的耀斑，增强效果
        float flicker = sin(time * 10.0 + pos.x * 0.5) * cos(time * 8.0 + pos.y * 0.5) * 0.7 + 0.6;
        
        // 随时间淡入淡出，但保持较高基础亮度
        float fadeOut = sin(time * 0.5) * 0.4 + 0.6;
        
        vec3 finalColor = color * (flicker * fadeOut) * 1.5; // 增加整体亮度
        float alpha = flicker * fadeOut * 0.8; // 增加不透明度
        
        gl_FragColor = vec4(finalColor, alpha);
      }
    `,transparent:!0,blending:oe,side:We,depthWrite:!1}),it=new v(Qt,ot);it.rotation.x=Math.PI/4,it.rotation.y=Math.PI/5,t.add(it);const rt=new v(Qt,ot);rt.rotation.x=Math.PI/3,rt.rotation.z=Math.PI/2,t.add(rt);const es=new js(120*1.5,32,32),Jt=new Le({uniforms:{time:{value:0},baseColor:{value:new _(16755251)},glowColor:{value:new _(16733440)}},vertexShader:`
      varying vec3 vNormal;
      varying vec3 vWorldPosition;
      
      void main() {
        vNormal = normalize(normalMatrix * normal);
        vec4 worldPosition = modelMatrix * vec4(position, 1.0);
        vWorldPosition = worldPosition.xyz;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform vec3 baseColor;
      uniform vec3 glowColor;
      uniform float time;
      
      varying vec3 vNormal;
      varying vec3 vWorldPosition;
      
      void main() {
        // 计算视角方向
        vec3 viewDir = normalize(cameraPosition - vWorldPosition);
        
        // 获取法线和视角方向之间的点积
        float rimEffect = 1.0 - dot(vNormal, viewDir);
        
        // 应用圆形功率函数使边缘更加明显
        rimEffect = pow(rimEffect, 2.0);
        
        // 添加时间变化的噪声
        float noise = sin(time * 2.0 + vWorldPosition.x * 0.1) * 
                     cos(time * 1.5 + vWorldPosition.y * 0.1) * 
                     sin(time + vWorldPosition.z * 0.1);
        
        // 扰动边缘效果
        rimEffect += noise * 0.1;
        
        // 计算最终颜色
        vec3 finalColor = mix(baseColor, glowColor, rimEffect);
        
        // 设置透明度基于边缘效果
        float alpha = rimEffect * 0.8;
        
        gl_FragColor = vec4(finalColor, alpha);
      }
    `,transparent:!0,blending:oe,side:Ks,depthWrite:!1}),ts=new v(es,Jt);t.add(ts);const Oe=new Be,Ue=150,ce=new Float32Array(Ue*3),Ke=new Float32Array(Ue*3),at=new Float32Array(Ue),Zt=[],$t=[];for(let G=0;G<Ue;G++){const b=Math.random()*Math.PI*2,Q=Math.acos(2*Math.random()-1),J=100;ce[G*3]=J*Math.sin(Q)*Math.cos(b),ce[G*3+1]=J*Math.sin(Q)*Math.sin(b),ce[G*3+2]=J*Math.cos(Q),Ke[G*3]=1,Ke[G*3+1]=.3+Math.random()*.4,Ke[G*3+2]=Math.random()*.2,at[G]=2+Math.random()*3;const Z=ce[G*3]*.01,Ae=ce[G*3+1]*.01,ct=ce[G*3+2]*.01;Zt.push({x:Z,y:Ae,z:ct});const _e=1+Math.random()*3;$t.push({current:Math.random()*_e,max:_e})}Oe.setAttribute("position",new ie(ce,3)),Oe.setAttribute("color",new ie(Ke,3)),Oe.setAttribute("size",new ie(at,1));const ns=new Le({uniforms:{time:{value:0}},vertexShader:`
      attribute float size;
      attribute vec3 color;
      varying vec3 vColor;
      
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        gl_PointSize = size * (200.0 / -mvPosition.z);
        gl_Position = projectionMatrix * mvPosition;
      }
    `,fragmentShader:`
      varying vec3 vColor;
      
      void main() {
        // 创建圆形点
        float r = distance(gl_PointCoord, vec2(0.5, 0.5));
        if (r > 0.5) discard;
        
        // 亮边缘效果
        float intensity = 1.0 - 2.0 * r;
        gl_FragColor = vec4(vColor * intensity, intensity);
      }
    `,blending:oe,depthWrite:!1,transparent:!0,vertexColors:!0}),ss=new Ze(Oe,ns);t.add(ss);const os={positions:ce,velocities:Zt,lifeTimes:$t,sizes:at,particleCount:Ue,geometry:Oe,update:function(G){for(let b=0;b<this.particleCount;b++)if(this.lifeTimes[b].current-=G,this.lifeTimes[b].current<=0){const Q=Math.random()*Math.PI*2,J=Math.acos(2*Math.random()-1),Z=100;this.positions[b*3]=Z*Math.sin(J)*Math.cos(Q),this.positions[b*3+1]=Z*Math.sin(J)*Math.sin(Q),this.positions[b*3+2]=Z*Math.cos(J),this.velocities[b].x=this.positions[b*3]*.01,this.velocities[b].y=this.positions[b*3+1]*.01,this.velocities[b].z=this.positions[b*3+2]*.01,this.lifeTimes[b].max=1+Math.random()*3,this.lifeTimes[b].current=this.lifeTimes[b].max,this.sizes[b]=2+Math.random()*3}else{this.positions[b*3]+=this.velocities[b].x*G*15,this.positions[b*3+1]+=this.velocities[b].y*G*15,this.positions[b*3+2]+=this.velocities[b].z*G*15;const Q=this.lifeTimes[b].current/this.lifeTimes[b].max;this.sizes[b]=(2+Math.random()*3)*Q}this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.size.needsUpdate=!0}};function Y(G,b,Q,J){const Z=document.createElement("canvas");Z.width=512,Z.height=128;const Ae=Z.getContext("2d"),ct=50,_e=Math.pow(J/g,.5),is=ct*_e*2,rs=25*_e,as=Math.max(30,Math.min(60,40*_e));Ae.font=`bold ${as}px Arial`,Ae.fillStyle="white",Ae.textAlign="center",Ae.textBaseline="middle";const cs=`${G}(${b})`;Ae.fillText(cs,256,64);const ls=new Vs(Z),us=new Ws({map:ls,transparent:!0,depthTest:!1}),Ve=new Xs(us),ds=J*2.5;return Ve.position.set(0,ds,0),Ve.scale.set(is,rs,1),Q.add(Ve),Ve}return Y("Sun","太阳",t,h),Y("Mercury","水星",D,g*P),Y("Venus","金星",ae,g*N),Y("Earth","地球",Me,g),Y("Moon","月球",Se,g*C),Y("Mars","火星",Re,g*te),Y("Jupiter","木星",Ee,g*X),Y("Saturn","土星",me,g*k),Y("Uranus","天王星",ge,g*T),Y("Neptune","海王星",be,g*ne),Y("Pluto","冥王星",ve,g*B),{solarSystem:t,sunMesh:s,sunCoreMesh:c,sunGlowMesh:d,sunShaderMaterial:n,solarFlareRingMaterial:ot,sunAtmosphereMaterial:Jt,sunEruptionSystem:os,mercurySystem:D,mercuryMesh:se,venusSystem:ae,venusMesh:Et,earthSystem:Me,earthMesh:vt,lightsMesh:_t,cloudsMesh:et,earthGlowMesh:tt,moonSystem:Se,moonMesh:It,marsSystem:Re,marsMesh:Ct,jupiterSystem:Ee,jupiterMesh:Dt,saturnSystem:me,saturnMesh:Gt,saturnRingMesh:nt,uranusSystem:ge,uranusMesh:Bt,uranusRingMesh:st,neptuneSystem:be,neptuneMesh:Vt,plutoSystem:ve,plutoMesh:qt}}function dn(u,e,t){const i=new Be,n=[],s=[],o=[];for(let a=0;a<=t;a++){const r=a/t*Math.PI*2,c=Math.cos(r),d=Math.sin(r);n.push(u*c,0,u*d),s.push(a/t,0),n.push(e*c,0,e*d),s.push(a/t,1)}for(let a=0;a<t;a++){const r=a*2;o.push(r,r+1,r+2),o.push(r+1,r+3,r+2)}return i.setAttribute("position",new Qe(n,3)),i.setAttribute("uv",new Qe(s,2)),i.setIndex(o),i.computeVertexNormals(),i}const fn=10,Do=11.2,Fo=9.45,Pn=window.innerWidth,Cn=window.innerHeight,W=new qs,we=new _n(75,Pn/Cn,.1,1e4);we.position.z=500;const ko=new w(0,1,2),Ce=new Ys({antialias:!0});Ce.setSize(Pn,Cn);document.body.appendChild(Ce.domElement);Ce.toneMapping=Qs;Ce.outputColorSpace=ee;const On=Uo();W.add(On.solarSystem);const Un=new Ne(16777198,150,0,1);W.add(Un);const Dn=new Ne(16777198,120,0,1);W.add(Dn);const Xe=new Je(16777198,20,0,Math.PI*.75,3,2);W.add(Xe);const qe=new Je(16777198,16,0,Math.PI*.75,3,2);W.add(qe);const{solarSystem:Go,sunMesh:zo,sunCoreMesh:Ho,sunGlowMesh:Bo,sunShaderMaterial:hn,solarFlareRingMaterial:pn,sunAtmosphereMaterial:mn,sunEruptionSystem:ht,mercurySystem:gn,mercuryMesh:jo,venusSystem:An,venusMesh:Ko,earthSystem:xt,earthMesh:Vo,lightsMesh:Wo,cloudsMesh:Xo,earthGlowMesh:qo,moonSystem:Tt,moonMesh:Yo,marsSystem:xn,marsMesh:Qo,jupiterSystem:wt,jupiterMesh:de,saturnSystem:Mt,saturnMesh:fe,saturnRingMesh:Jo,uranusSystem:Tn,uranusMesh:Zo,uranusRingMesh:$o,neptuneSystem:wn,neptuneMesh:ei,plutoSystem:Mn,plutoMesh:ti}=On,ni=Tt.children.find(u=>u.material&&u.material.type==="ShaderMaterial"),Fn=Co({numStars:2e3});W.add(Fn);console.log("星空对象已添加:",Fn);const si=new Js(4210752,2);W.add(si);const U=new H;W.add(U);const Pe=new Je(16777215,100,20,Math.PI/4,.5,2);Pe.position.set(0,2.5,0);Pe.target=U;Pe.castShadow=!0;W.add(Pe);const S={pitchUp:!1,pitchDown:!1,bankLeft:!1,bankRight:!1,boost:!1,stop:!1,baseSpeed:.4,boostSpeed:1.2,speed:.4,maxBankAngle:Math.PI/6},L=Oo({count:100,color:65535,size:{min:.025,max:.05},lifetime:{min:.5,max:.6},speed:{min:.2,max:.6},spread:{x:.05,y:.05,z:.08}});W.add(L.particles);const oi=new Zs;oi.load("./model/source/Gladiator.glb",u=>{const e=u.scene,t=new He,i=t.load("./model/textures/Texture.png"),n=t.load("./model/textures/Emission.png"),s=t.load("./model/textures/Metalness.png"),o=t.load("./model/textures/Roughness.png");e.traverse(M=>{if(M.isMesh){const O=new pe({map:i,emissiveMap:n,emissive:16777215,emissiveIntensity:.5,metalnessMap:s,metalness:.8,roughnessMap:o,roughness:.2,envMapIntensity:1.5});M.castShadow=!0,M.receiveShadow=!0,M.material=O}}),e.scale.set(.0125,.0125,.0125),e.rotation.y=Math.PI,U.add(e),U.position.copy(xt.position),U.position.y+=20,U.position.z+=60;const a=new w;U.getWorldPosition(a);const r=new w;U.getWorldDirection(r),r.negate();const c=new w(0,1,0),d=new w;d.crossVectors(r,c).normalize();const l=new w;l.crossVectors(d,r).normalize();const f=.001,h=.001,m=-.001,y=new w().addScaledVector(r,-f).addScaledVector(d,h).addScaledVector(l,m),A=new w().addScaledVector(r,-f).addScaledVector(d,-h).addScaledVector(l,m);L.setPosition(a),L.setEmitterPositions(y,A);const x=r.clone().negate();L.particles.userData.initialized||(L.init(x,d,l),L.particles.userData.initialized=!0,console.log("粒子系统已初始化"))},void 0,u=>{console.error("加载模型时出错:",u)});let yn=0;function Ye(){if(L&&L.particles){if(S.stop){L.particles.visible=!1,requestAnimationFrame(Ye);return}if(L.particles.visible=!0,!U.children.length){requestAnimationFrame(Ye);return}const u=new w;U.getWorldPosition(u);const e=new w;U.getWorldDirection(e),e.negate();const t=new w(0,1,0),i=new w;i.crossVectors(e,t).normalize();const n=new w;n.crossVectors(i,e).normalize();const s=.001,o=.001,a=-.001,r=new w().addScaledVector(e,-s).addScaledVector(i,o).addScaledVector(n,a),c=new w().addScaledVector(e,-s).addScaledVector(i,-o).addScaledVector(n,a);L.setPosition(u),L.setEmitterPositions(r,c);const d=e.clone().negate();if(L.particles.userData.lastDirection){const h=L.particles.userData.lastDirection;(d.angleTo(h)>.174||L.particles.userData.lastBoostState!==S.boost)&&L.clearAllParticles&&L.clearAllParticles()}L.particles.userData.lastDirection=d.clone(),L.particles.userData.lastBoostState=S.boost,L.particles.userData.initialized||(L.init(d,i,n),L.particles.userData.initialized=!0,console.log("粒子系统已初始化"));const l=S.boost,f=S.speed;L.update(1/60,f,l,d,i,n)}requestAnimationFrame(Ye)}Ye();function ii(){const u=new w;wt.getWorldPosition(u);const e=new w;Mt.getWorldPosition(e);const t=new w(0,0,0).sub(u).normalize();Un.position.copy(u).addScaledVector(t,fn*Do*1.1);const i=new w(0,0,0).sub(e).normalize();Dn.position.copy(e).addScaledVector(i,fn*Fo*1.1),Xe.position.copy(u).addScaledVector(t,-3e3),Xe.target=de,Xe.lookAt(u),qe.position.copy(e).addScaledVector(i,-3e3),qe.target=fe,qe.lookAt(e)}function kn(u=0){requestAnimationFrame(kn);const e=(u-yn)/1e3;yn=u,ii(),de&&de.material&&(de.material.emissive||(de.material.emissive=new _(5583633),de.material.emissiveIntensity=.3,de.material.needsUpdate=!0)),fe&&fe.material&&(fe.material.emissive||(fe.material.emissive=new _(5588002),fe.material.emissiveIntensity=.3,fe.material.needsUpdate=!0)),hn&&(hn.uniforms.time.value+=e),pn&&(pn.uniforms.time.value+=e),mn&&(mn.uniforms.time.value+=e),ht&&ht.update&&ht.update(e);const t=400,i=.39,n=.72,s=1,o=1.52,a=5.2,r=9.54,c=19.2,d=30.06,l=39.5;jo.rotation.y+=.001;const f=Date.now()*2e-4;gn.position.x=Math.cos(f)*t*i*5/15,gn.position.z=Math.sin(f)*t*i*5/15,Ko.rotation.y-=5e-4;const h=Date.now()*15e-5;An.position.x=Math.cos(h)*t*n,An.position.z=Math.sin(h)*t*n,Vo.rotation.y+=.002,Wo.rotation.y+=.002,Xo.rotation.y+=.0023,qo.rotation.y+=.002;const m=Date.now()*1e-4;xt.position.x=Math.cos(m)*t*s,xt.position.z=Math.sin(m)*t*s,Yo.rotation.y+=.001,ni.rotation.y+=.001;const y=Date.now()*5e-4,A=10;Tt.position.x=Math.cos(y)*A*2.5,Tt.position.z=Math.sin(y)*A*2.5,Qo.rotation.y+=.0019;const x=Date.now()*8e-5;xn.position.x=Math.cos(x)*t*o,xn.position.z=Math.sin(x)*t*o,de.rotation.y+=.005;const M=Date.now()*4e-5;wt.position.x=Math.cos(M)*t*a,wt.position.z=Math.sin(M)*t*a,fe.rotation.y+=.0045,Jo.rotation.z+=2e-4;const O=Date.now()*3e-5;Mt.position.x=Math.cos(O)*t*r,Mt.position.z=Math.sin(O)*t*r,Zo.rotation.z+=.003,$o.rotation.z+=5e-4;const p=Date.now()*2e-5;Tn.position.x=Math.cos(p)*t*c,Tn.position.z=Math.sin(p)*t*c,ei.rotation.y+=.004;const R=Date.now()*15e-6;wn.position.x=Math.cos(R)*t*d,wn.position.z=Math.sin(R)*t*d,ti.rotation.y+=.001;const I=Date.now()*1e-5;if(Mn.position.x=Math.cos(I)*t*l,Mn.position.z=Math.sin(I)*t*l,zo.rotation.y+=5e-4,Ho.rotation.y+=5e-4,Bo.rotation.y+=3e-4,U){const F=Date.now()*.001,g=S.pitchUp||S.pitchDown?0:2;if(U.position.y=Math.sin(F)*g,Pe){const C=new w;U.getWorldPosition(C),Pe.position.set(C.x,C.y+2.5,C.z)}const P=new w;U.getWorldDirection(P),P.negate();const N=new w;N.crossVectors(P,new w(0,1,0)).normalize(),new w().crossVectors(N,P).normalize();const X=new K;U.getWorldQuaternion(X);let k=new K().copy(X),T=!1;if(S.stop||U.position.addScaledVector(P,S.speed),S.pitchUp&&!S.stop){const C=new K().setFromAxisAngle(N,.02);k.premultiply(C),T=!0}if(S.pitchDown&&!S.stop){const C=new K().setFromAxisAngle(N,-.02);k.premultiply(C),T=!0}if(S.bankLeft&&!S.stop){U.position.addScaledVector(N,S.speed*.05);const C=Math.min(.05,S.maxBankAngle),D=new K().setFromAxisAngle(P,-C);k.premultiply(D);const z=new K().setFromAxisAngle(new w(0,1,0),.2);k.premultiply(z),T=!0}if(S.bankRight&&!S.stop){U.position.addScaledVector(N,S.speed*-.05);const C=Math.min(.05,S.maxBankAngle),D=new K().setFromAxisAngle(P,C);k.premultiply(D);const z=new K().setFromAxisAngle(new w(0,1,0),-.2);k.premultiply(z),T=!0}if(T)U.quaternion.slerp(k,.1);else{const C=new K;U.getWorldQuaternion(C);const D=new K,z=new w;U.getWorldDirection(z),z.negate();const q=new w(0,1,0),se=new w;se.crossVectors(z,q).normalize(),new w().crossVectors(se,z).normalize();const ae=new ze().lookAt(new w,z,q);D.setFromRotationMatrix(ae),U.quaternion.slerp(D,.02)}const B=new w().copy(ko).applyMatrix4(U.matrixWorld);S.boost?we.position.lerp(B,.05):we.position.copy(B),we.lookAt(U.position)}Ce.render(W,we)}function ri(u){switch(u.code){case"KeyW":S.pitchUp=!0;break;case"KeyS":S.pitchDown=!0;break;case"KeyA":S.bankLeft=!0;break;case"KeyD":S.bankRight=!0;break;case"ShiftLeft":case"ShiftRight":S.boost=!0,S.speed=S.boostSpeed;break;case"Space":S.stop=!0,L&&L.clearAllParticles&&L.clearAllParticles();break}}function ai(u){switch(u.code){case"KeyW":S.pitchUp=!1;break;case"KeyS":S.pitchDown=!1;break;case"KeyA":S.bankLeft=!1;break;case"KeyD":S.bankRight=!1;break;case"ShiftLeft":case"ShiftRight":S.boost=!1,S.speed=S.baseSpeed;break;case"Space":S.stop=!1,L&&L.clearAllParticles&&L.clearAllParticles();break}}window.addEventListener("keydown",ri);window.addEventListener("keyup",ai);window.addEventListener("resize",function(){const u=window.innerWidth,e=window.innerHeight;Ce.setSize(u,e),we.aspect=u/e,we.updateProjectionMatrix()});kn();function ci(){const u=document.createElement("div");u.style.position="absolute",u.style.top="20px",u.style.left="20px",u.style.width="300px",u.style.padding="15px",u.style.backgroundColor="rgba(0, 50, 100, 0.6)",u.style.borderRadius="10px",u.style.boxShadow="0 0 10px rgba(0, 100, 200, 0.5)",u.style.color="white",u.style.fontFamily="Arial, sans-serif",u.style.zIndex="1000";const e=document.createElement("h2");e.textContent="欢迎搭乘Justike的宇宙飞船",e.style.textAlign="center",e.style.margin="0 0 10px 0",e.style.fontSize="18px",e.style.color="#0cf",u.appendChild(e);const t=document.createElement("p");t.textContent="尝试用WASD键操控飞船运行",t.style.textAlign="center",t.style.margin="5px 0",t.style.fontSize="16px",u.appendChild(t);const i=document.createElement("p");i.textContent="按Shift键加速",i.style.textAlign="center",i.style.margin="5px 0",i.style.fontSize="16px",u.appendChild(i);const n=document.createElement("p");n.textContent="按下Space键后停止飞行",n.style.textAlign="center",n.style.margin="5px 0",n.style.fontSize="16px",u.appendChild(n),document.body.appendChild(u)}ci();setTimeout(()=>{const u=W.getObjectByName("starfield");u?(console.log("星空对象状态:",{可见性:u.visible,位置:u.position,星星数量:u.geometry.attributes.position.count,材质设置:{size:u.material.size,透明度:u.material.opacity,深度测试:u.material.depthTest}}),u.visible=!0,u.material.needsUpdate=!0):console.log("未找到星空对象！")},2e3);const Fe=Go.children.find(u=>u instanceof Ne);Fe&&(Fe.distance=1e10,Fe.intensity=1e6,console.log("已调整太阳光源范围:",Fe.distance,"强度:",Fe.intensity));
